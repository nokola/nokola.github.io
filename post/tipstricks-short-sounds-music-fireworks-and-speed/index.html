<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>System Failure | Tips/Tricks: Short Sounds, Fireworks and BitmapCache Speed</title><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=generator content="Hugo 0.59.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link href=https://systemfailure.io/dist/main.css rel=stylesheet type=text/css><meta property="og:title" content="Tips/Tricks: Short Sounds, Fireworks and BitmapCache Speed"><meta property="og:description" content="This blog post is a follow-up of the previous one dedicated to the Shock improvements.
I'll just list all tips or other interesting findings/updates in no particular order:
Playing Short Sounds in Silverlight (Improved) You probably know by now that Silverlight (2,3) has an annoying issue with short sounds - sometimes the sound is not played correctly. The simple workaround is here.&nbsp;
If you happen to play too many sounds/sec, the above workaround can cause your memory usage to&nbsp;grow more than you want to&nbsp;for short time."><meta property="og:type" content="article"><meta property="og:url" content="https://systemfailure.io/post/tipstricks-short-sounds-music-fireworks-and-speed/"><meta property="article:published_time" content="2010-01-04T10:17:00+00:00"><meta property="article:modified_time" content="2010-01-04T10:17:00+00:00"><meta itemprop=name content="Tips/Tricks: Short Sounds, Fireworks and BitmapCache Speed"><meta itemprop=description content="This blog post is a follow-up of the previous one dedicated to the Shock improvements.
I'll just list all tips or other interesting findings/updates in no particular order:
Playing Short Sounds in Silverlight (Improved) You probably know by now that Silverlight (2,3) has an annoying issue with short sounds - sometimes the sound is not played correctly. The simple workaround is here.&nbsp;
If you happen to play too many sounds/sec, the above workaround can cause your memory usage to&nbsp;grow more than you want to&nbsp;for short time."><meta itemprop=datePublished content="2010-01-04T10:17:00&#43;00:00"><meta itemprop=dateModified content="2010-01-04T10:17:00&#43;00:00"><meta itemprop=wordCount content="554"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Tips/Tricks: Short Sounds, Fireworks and BitmapCache Speed"><meta name=twitter:description content="This blog post is a follow-up of the previous one dedicated to the Shock improvements.
I'll just list all tips or other interesting findings/updates in no particular order:
Playing Short Sounds in Silverlight (Improved) You probably know by now that Silverlight (2,3) has an annoying issue with short sounds - sometimes the sound is not played correctly. The simple workaround is here.&nbsp;
If you happen to play too many sounds/sec, the above workaround can cause your memory usage to&nbsp;grow more than you want to&nbsp;for short time."></head><body class="ma0 body-font"><style>.shadow-bottom{-webkit-box-shadow:0 0 15px 0 #afafaf;-moz-box-shadow:0 0 15px 0 #afafaf;box-shadow:0 0 15px 0 #afafaf}.pad-2{padding:2px 0}.sub-space{display:block;font-size:20px;font-weight:400;padding-top:10px}.nested-img img{width:initial;height:auto}a{color:#06f}pre{overflow:auto;color:#ddd;white-space:pre;border:1px solid #41a85f;border-left:none;border-right:none;hyphens:none;position:relative;border-radius:2px;margin-left:-32px;margin-right:-32px;padding:0 16px;box-shadow:0 2px 14px 0 #0b0107}a{text-decoration:none}a:hover{text-decoration:underline}.word-wrap{word-wrap:break-word}.lh-copy{line-height:1.42857143}.title-font{font-weight:700;color:#cecece}.body-font{font-family:Georgia,times new roman,Times,serif}.mw6{max-width:36rem}.mt3and5{margin-top:1.5rem}article{border-radius:4px 4px}body{background:#2f3031;color:#eee}.main-link{display:block;color:inherit}.main-link:hover{text-decoration:none}.summary-article:hover{box-shadow:0 0 12px 7px rgba(0,0,0,.12)}article img{display:block}.nested-links a{color:#54acd2;font-variant:small-caps;letter-spacing:.8px}.top-link:hover{background:#464646;border-radius:4px;text-decoration:none}.gradient-top{background:#020024;background:linear-gradient(90deg,rgb(121,66,0) 0%,rgb(107,74,0) 35%,rgb(57,42,0) 100%);height:4px;border-radius:4px 4px 0 0}.gradient-top.single,.summary-article:hover .gradient-top{background:linear-gradient(90deg,rgb(19,99,3) 0%,rgb(16,68,52) 35%,rgb(32,45,31) 100%)}.utterances{margin-left:0}.f5{font-size:18px}</style><header class="mb5 cover bg-top bg-left shadow-bottom" style=background-image:url(https://systemfailure.io/header/tree1.jpg)><div><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l items-center center"><section class="w-100 mw8 center"><a href=https://systemfailure.io/ class="top-link pa3 f5 fw4 hover-white no-underline white-90 dib">System Failure<div class="f7 white-70 pad-2 sub-space">Nokola&#39;s handwritten blog on software and humans.</div></a><div class="flex-l items-center"></div></section></div></nav></div></header><main class="pb7 ph0 ph4-ns ph0-m" role=main><div class="flex-l mt2 mw8 center"><div><article class="center cf word-wrap"><div class="gradient-top single"></div><h1 class="f3 title-font ph4-ns ph3 pt3 mt3">Tips/Tricks: Short Sounds, Fireworks and BitmapCache Speed</h1><div class="ph4-ns mw8 ph3 pb2"><p class="f7 pt1 pb3 silver"><span>Jan 4, 2010</span></p><section class="nested-copy-line-height lh-copy f5 nested-links nested-img light-gray"><p>This blog post is a follow-up of the <a href=http://nokola.com/blog/post/2009/12/25/Shock-Game-got-new-character-Old-Man-(the-one-with-the-raindeer).aspx>previous one</a> dedicated to the <a href=http://nokola.com/shock>Shock</a> improvements.</p><p>I'll just list all tips or other interesting findings/updates in no particular order:</p><h2>Playing Short Sounds in Silverlight (Improved)</h2><p>You probably know by now that Silverlight (2,3) has an annoying issue with short sounds - sometimes the sound is not played correctly. The simple <a href=http://kindohm.com/archive/2009/01/21/workaround-for-quotshort-soundquot-silverlight-bug.aspx>workaround is here</a>.&nbsp;</p><p>If you happen to play too many sounds/sec, the above workaround can cause your memory usage to&nbsp;grow more than you want to&nbsp;for short time. The easiest way to avoid the surge in mem usage is to cache the streams that contain the .mp3 sounds, like this:</p><p>[code:c#]</p><p>private static Dictionary&lt;string, Stream&gt; _streams = new Dictionary&lt;string, Stream&gt;();</p><p>public static void PlayShortSound(string embeddedSoundName, double volume)<br>{<br>&nbsp;&nbsp;&nbsp; Stream stream;<br>&nbsp;&nbsp;&nbsp; if (!_streams.TryGetValue(embeddedSoundName, out stream))<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stream = Application.GetResourceStream(new Uri(String.Format("/Shock;component/Sounds/{0}", embeddedSoundName), UriKind.Relative)).Stream;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _streams[embeddedSoundName] = stream;<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; MediaElement media = new MediaElement();<br>&nbsp;&nbsp;&nbsp; _soundContainer.Children.Add(media);<br>&nbsp;&nbsp;&nbsp; media.MediaFailed += media_MediaFailed;<br>&nbsp;&nbsp;&nbsp; media.MediaEnded += media_MediaEnded;<br>&nbsp;&nbsp;&nbsp; media.Volume = volume;<br>&nbsp;&nbsp;&nbsp; media.AutoPlay = true;<br>&nbsp;&nbsp;&nbsp; media.Position = TimeSpan.FromMilliseconds(0);<br>&nbsp;&nbsp;&nbsp; media.SetSource(stream);<br>}</p><p>[/code]</p><p>Then, just call the function like this example: PlayShortSound("explosion.mp3").&nbsp;You can use this trick, because multiple sounds using&nbsp;the same stream&nbsp;don't cause issues with each other, which is nice.</p><h2>"Shatter" Effect</h2><p>In my previous blog post I mentioned the "shatter" brick effect, which is based on this one:&nbsp; <a href=http://www.shinedraw.com/animation-effect/flash-vs-silverlight-colorful-fireworks/>http://www.shinedraw.com/animation-effect/flash-vs-silverlight-colorful-fireworks/</a></p><p>I changed the effect and made it self-recycling: removes itself from the parent after a given time period. It will also display "fireworks" in an area, not&nbsp; a dot. All of these are really small modifications, but help make the effect "run and forget", and easy to use for "shattering" stuff like bricks.</p><p>Here's an usage sample:</p><p>[code:c#]</p><p>public static TimeSpan ShatterEffectTimeSpan = TimeSpan.FromSeconds(0.3);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Fireworks fireworks = new Fireworks(TimeSpan.FromSeconds(0.3), (int)width, (int)height, brickAppearance == BrickAppearance.Ice);<br>Canvas.SetLeft(fireworks, centerX);<br>Canvas.SetTop(fireworks, centerY);<br>Globals.BoomContaier.Children.Add(fireworks);<br>fireworks.Start();<br>[/code]</p><p>And here's the source code. Note: get the complete sample from the shinedraw.com link above and then change the 2 files below. The code won't compile, but you just have to call your own Random() function, and maybe fix few other basic things.</p><p><a href="/blog/file.axd?file=2010%2f1%2fFireworks.xaml.cs">Fireworks.xaml.cs (4.98 kb)</a>&nbsp; <a href="/blog/file.axd?file=2010%2f1%2fMagicDot.cs">MagicDot.cs (2.89 kb)</a></p><p>I want to call out something very interesting in the above effect (not made by me originally) - each MagicDot is created within its own container. I believe it will cause less layout work than putting all dots within the same container (this is a gut-feeling unverified speculation)</p><p>If you want to see the shatter effect in action, break the ice bricks on level 2 of Shock: <a href=http://nokola.com/shock>http://nokola.com/shock</a></p><h2>When (Not) To Use BitmapCache, Even For Images That Don't Move</h2><p>I found out that if I use CacheMode="BitmapCache" for each brick (100+ per level), the performance suffers. This is very interesting, and is something to keep in mind when using bitmap cache.</p><p>Seems like the larger the image, the better.</p><h2>More On Speed</h2><p>Some blogs (don't remember where) mention that images with Opacity=0 still render and take valuable CPU/GPU time - I tested it and it seems that in Silverlight 4 Beta this is not the case.</p><p>I observed no noticeable speed change when a UserControl (the highscore) had Opacity=0 vs Visibility=Invisible. Note, however that Opacity=0 means you get hit testing, so there is some speed difference - don't just blindly overuse Opacity=0 instead of Visibility=Invisible.</p><p>&nbsp;</p></section><div class=mt5></div><script src=https://utteranc.es/client.js repo=nokola/blog issue-term=pathname label=comment theme=github-dark crossorigin=anonymous async></script></div></article></div></div></main><footer class="bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f7 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://systemfailure.io/>&copy; 2020 System Failure</a></div></footer><script src=https://systemfailure.io/dist/app.bundle.js async></script></body></html>