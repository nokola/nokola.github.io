<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>System Failure | Quick and Dirty Output of WriteableBitmap as TGA Image</title><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=generator content="Hugo 0.59.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link href=https://systemfailure.io/dist/main.css rel=stylesheet type=text/css><meta property="og:title" content="Quick and Dirty Output of WriteableBitmap as TGA Image"><meta property="og:description" content="If you ever needed to save a WriteableBitmap to an image&nbsp;file without too much hassle (e.g. for debugging purposes), you could use this simple source code to save it as TGA and then open with Paint.NET:
From Wikipedia: &#34;TGA files are in widespread use due to their simplicity and ease of implementation and lack of encumbering patents.&#34;
[code:c#]
public static class TgaWriter {
&nbsp;&nbsp;&nbsp; public static void Write(WriteableBitmap bitmap, Stream output) {"><meta property="og:type" content="article"><meta property="og:url" content="https://systemfailure.io/post/quick-and-dirty-output-of-writeablebitmap-as-tga-image/"><meta property="article:published_time" content="2010-01-21T20:17:00+00:00"><meta property="article:modified_time" content="2010-01-21T20:17:00+00:00"><meta itemprop=name content="Quick and Dirty Output of WriteableBitmap as TGA Image"><meta itemprop=description content="If you ever needed to save a WriteableBitmap to an image&nbsp;file without too much hassle (e.g. for debugging purposes), you could use this simple source code to save it as TGA and then open with Paint.NET:
From Wikipedia: &#34;TGA files are in widespread use due to their simplicity and ease of implementation and lack of encumbering patents.&#34;
[code:c#]
public static class TgaWriter {
&nbsp;&nbsp;&nbsp; public static void Write(WriteableBitmap bitmap, Stream output) {"><meta itemprop=datePublished content="2010-01-21T20:17:00&#43;00:00"><meta itemprop=dateModified content="2010-01-21T20:17:00&#43;00:00"><meta itemprop=wordCount content="414"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Quick and Dirty Output of WriteableBitmap as TGA Image"><meta name=twitter:description content="If you ever needed to save a WriteableBitmap to an image&nbsp;file without too much hassle (e.g. for debugging purposes), you could use this simple source code to save it as TGA and then open with Paint.NET:
From Wikipedia: &#34;TGA files are in widespread use due to their simplicity and ease of implementation and lack of encumbering patents.&#34;
[code:c#]
public static class TgaWriter {
&nbsp;&nbsp;&nbsp; public static void Write(WriteableBitmap bitmap, Stream output) {"></head><body class="ma0 body-font"><style>.shadow-bottom{-webkit-box-shadow:0 0 15px 0 #afafaf;-moz-box-shadow:0 0 15px 0 #afafaf;box-shadow:0 0 15px 0 #afafaf}.pad-2{padding:2px 0}.sub-space{display:block;font-size:20px;font-weight:400;padding-top:10px}.nested-img img{width:initial;height:auto}a{color:#06f}pre{overflow:auto;color:#ddd;white-space:pre;border:1px solid #41a85f;border-left:none;border-right:none;hyphens:none;position:relative;border-radius:2px;margin-left:-32px;margin-right:-32px;padding:0 16px;box-shadow:0 2px 14px 0 #0b0107}a{text-decoration:none}a:hover{text-decoration:underline}.word-wrap{word-wrap:break-word}.lh-copy{line-height:1.42857143}.title-font{font-weight:700;color:#cecece}.body-font{font-family:segoe ui,Tahoma,Geneva,Verdana,sans-serif}.mw6{max-width:36rem}.mt3and5{margin-top:1.5rem}article{background:#1b1b1b;border-radius:4px 4px}body{background:#2f3031;color:#eee}.main-link{display:block;color:inherit}.main-link:hover{text-decoration:none}.summary-article:hover{box-shadow:0 0 12px 7px rgba(0,0,0,.12)}article img{display:block}.nested-links a{color:#54acd2;font-variant:small-caps;letter-spacing:.8px}.top-link:hover{background:#464646;border-radius:4px;text-decoration:none}.gradient-top{background:#020024;background:linear-gradient(90deg,rgb(121,66,0) 0%,rgb(107,74,0) 35%,rgb(57,42,0) 100%);height:4px;border-radius:4px 4px 0 0}.gradient-top.single,.summary-article:hover .gradient-top{background:linear-gradient(90deg,rgb(19,99,3) 0%,rgb(16,68,52) 35%,rgb(32,45,31) 100%)}.utterances{margin-left:0}</style><header class="mb5 cover bg-top bg-left" style=background-image:url(https://systemfailure.io/header/tree1.jpg)><div><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l items-center center"><section class="w-100 mw8 center"><a href=https://systemfailure.io/ class="top-link pa3 f5 fw4 hover-white no-underline white-90 dib"><div class="f7 white-70 pad-2 sub-space">Nokola&#39;s blog on software and humans.</div></a><div class="flex-l items-center"></div></section></div></nav></div></header><main class="pb7 ph0 ph4-ns ph0-m" role=main><div class="flex-l mt2 mw8 center"><div><article class="center cf word-wrap"><div class="gradient-top single"></div><h1 class="f3 title-font ph4-ns ph3 pt3 mt3">Quick and Dirty Output of WriteableBitmap as TGA Image</h1><div class="ph4-ns mw8 ph3 pb2"><p class="f7 pt1 pb3 silver"><span>Jan 21, 2010</span></p><section class="nested-copy-line-height lh-copy f5 nested-links nested-img light-gray"><p>If you ever needed to save a WriteableBitmap to an image&nbsp;file without too much hassle (e.g. for debugging purposes), you could use this simple source code to save it as TGA and then open with <a href=http://getpaint.net>Paint.NET</a>:</p><p>From Wikipedia: "TGA files are in widespread use due to their simplicity and ease of implementation and lack of encumbering patents."</p><p>[code:c#]</p><p>public static class TgaWriter {<br>&nbsp;&nbsp;&nbsp; public static void Write(WriteableBitmap bitmap, Stream output) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int width = bitmap.PixelWidth;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int height = bitmap.PixelHeight;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int[] pixels = bitmap.Pixels;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte[] pixelsArr = new byte[pixels.Length * 4];</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int offsetSource = 0;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int width4 = width * 4;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int width8 = width * 8;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int offsetDest = (height - 1) * width4;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int y = 0; y &lt; height; y++) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int x = 0; x &lt; width; x++) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int value = pixels[offsetSource];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pixelsArr[offsetDest] = (byte)(value &amp; 255); // b<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pixelsArr[offsetDest + 1] = (byte)((value &gt;&gt; 8) &amp; 255); // g<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pixelsArr[offsetDest + 2] = (byte)((value &gt;&gt; 16) &amp; 255); // r<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pixelsArr[offsetDest + 3] = (byte)(value &gt;&gt; 24); // a</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; offsetSource++;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; offsetDest += 4;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; offsetDest -= width8;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte[] header = new byte[] {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0, // ID length<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0, // no color map<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2, // uncompressed, true color<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0, 0, 0, 0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0, 0, 0, 0, // x and y origin<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (byte)(width &amp; 0x00FF),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (byte)((width &amp; 0xFF00) &gt;&gt; 8),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (byte)(height &amp; 0x00FF),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (byte)((height &amp; 0xFF00) &gt;&gt; 8),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32, // 32 bit bitmap<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 };</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (BinaryWriter writer = new BinaryWriter(output)) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; writer.Write(header);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; writer.Write(pixelsArr);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>}</p><p>[/code]</p><p>&nbsp;Here's a sample usage of the above class:</p><p><strong>Important Edit: </strong>if you want to support transparency, you'd have to call CompensateForRender() from this post: <a href=http://nokola.com/blog/post/2010/01/27/The-Most-Important-Silverlight-WriteableBitmap-Gotcha-Does-It-LoseChange-Colors.aspx>http://nokola.com/blog/post/2010/01/27/The-Most-Important-Silverlight-WriteableBitmap-Gotcha-Does-It-LoseChange-Colors.aspx</a></p><p>[code:c#]</p><p>private void btnSave_Click(object sender, RoutedEventArgs e) {<br>&nbsp;&nbsp;&nbsp; WriteableBitmap _screen;<br>&nbsp;&nbsp;&nbsp; // ... do something with the WriteableBitmap here...</p><p>&nbsp;&nbsp;&nbsp; SaveFileDialog dialog = new SaveFileDialog();<br>&nbsp;&nbsp;&nbsp; dialog.DefaultExt = ".tga";<br>&nbsp;&nbsp;&nbsp; dialog.Filter = "TGA Image (*.tga)|*.tga";<br>&nbsp;&nbsp;&nbsp; dialog.FilterIndex = 1;</p><p>&nbsp;&nbsp;&nbsp; if (dialog.ShowDialog() != true) return;<br>&nbsp;&nbsp;&nbsp; using (Stream fileStream = dialog.OpenFile()) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TgaWriter.Write(_screen, fileStream);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fileStream.Close();<br>&nbsp;&nbsp;&nbsp; }<br>}<br>[/code]</p><p>The benefit of the above code is that you don't have to worry about image libraries, external binary dependencies and such - just paste &amp; go :)</p><p>The TGA file format: <a href=http://en.wikipedia.org/wiki/Truevision_TGA>http://en.wikipedia.org/wiki/Truevision_TGA</a></p><p>&nbsp;</p></section><div class=mt5></div><script src=https://utteranc.es/client.js repo=nokola/blog issue-term=pathname label=comment theme=github-dark crossorigin=anonymous async></script></div></article></div></div></main><footer class="bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f7 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://systemfailure.io/>&copy; 2020 System Failure</a></div></footer><script src=https://systemfailure.io/dist/app.bundle.js async></script></body></html>